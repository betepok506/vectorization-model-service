# –û–ø–∏—Å–∞–Ω–∏–µ

–ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å –≤–µ–∫—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ —Ç–µ–∫—Å—Ç–æ–≤ –Ω–∞ –æ—Å–Ω–æ–≤–µ –Ω–µ–π—Ä–æ—Å–µ—Ç–µ–≤—ã—Ö –º–æ–¥–µ–ª–µ–π –∏–∑ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ HuggingFace Transformers.
–°–µ—Ä–≤–∏—Å –ø—Ä–∏–Ω–∏–º–∞–µ—Ç —Ç–µ–∫—Å—Ç–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è —á–µ—Ä–µ–∑ RabbitMQ , –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∏—Ö –ø–∞–∫–µ—Ç–∞–º–∏ –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤ —É–∫–∞–∑–∞–Ω–Ω—É—é –æ—á–µ—Ä–µ–¥—å.

### üìå –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:
- ‚úÖ –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–µ–∫—Å—Ç–æ–≤
- üì¶ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –±–∞—Ç—á–∏–Ω–≥–∞ (–Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–π —Ä–∞–∑–º–µ—Ä –±–∞—Ç—á–∞)
- üîÑ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ RabbitMQ
- üìä –ú–µ—Ç—Ä–∏–∫–∏ Prometheus –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
- üîÅ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ callback-–æ—á–µ—Ä–µ–¥–µ–π
- üßæ –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥—è—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ Pydantic

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

–ê–∫—Ç—É–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∏ —Ä–∞—Å–ø–∏—Å–∞—Ç—å
```
vectorization-service/
‚îú‚îÄ‚îÄ main.py                      # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞
‚îú‚îÄ‚îÄ config.py                    # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îú‚îÄ‚îÄ schemas/
‚îÇ   ‚îî‚îÄ‚îÄ vectorize_request.py   # –°—Ö–µ–º–∞ –≤—Ö–æ–¥—è—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö
‚îú‚îÄ‚îÄ models/
‚îÇ   ‚îî‚îÄ‚îÄ batch_processor.py     # –ü–∞–∫–µ—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–µ–∫—Å—Ç–æ–≤
‚îú‚îÄ‚îÄ rabbitmq_client.py         # –ö–ª–∏–µ–Ω—Ç RabbitMQ
‚îî‚îÄ‚îÄ services/
    ‚îî‚îÄ‚îÄ vectorization_service.py # –õ–æ–≥–∏–∫–∞ —Å–µ—Ä–≤–∏—Å–∞
```

## –ú–µ—Ç—Ä–∏–∫–∏

|–ù–∞–∑–≤–∞–Ω–∏–µ|–¢–∏–ø|–ï–¥–∏–Ω–∏—Ü–∞ –∏–∑–º–µ—Ä–µ–Ω–∏—è|–û–ø–∏—Å–∞–Ω–∏–µ|
|-----------------|-----------------|-----------------|-----------------|
|**vectorize_requests_total**|Counter|—à—Ç.|–û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –Ω–∞ –≤–µ–∫—Ç–æ—Ä–∏–∑–∞—Ü–∏—é|
|**vectorize_errors_total**|Counter|—à—Ç.|–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—à–∏–±–æ–∫ –ø—Ä–∏ –≤–µ–∫—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ (–≤–∞–ª–∏–¥–∞—Ü–∏—è, –º–æ–¥–µ–ª—å –∏ —Ç.–¥.)|
|**vectorize_latency_seconds**|Histogram|—Å–µ–∫—É–Ω–¥—ã|–í—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ–¥–Ω–æ–≥–æ –±–∞—Ç—á–∞ —Ç–µ–∫—Å—Ç–æ–≤|
|**vectorize_batch_size**|Gauge|—à—Ç.|–†–∞–∑–º–µ—Ä —Ç–µ–∫—É—â–µ–≥–æ –±–∞—Ç—á–∞ –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π –Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫—É|
|**vectorize_embeddings_dim**|Gauge|—à—Ç.|–†–∞–∑–º–µ—Ä–Ω–æ—Å—Ç—å —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤ (–Ω–∞–ø—Ä–∏–º–µ—Ä, 768 –¥–ª—è BERT)|
|**rabbitmq_messages_received_total**|Counter|—à—Ç.|–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ–æ–±—â–µ–Ω–∏–π, –ø–æ–ª—É—á–µ–Ω–Ω—ã—Ö –∏–∑ RabbitMQ|
|**rabbitmq_messages_published_total**|Counter|—à—Ç.|–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ–æ–±—â–µ–Ω–∏–π, –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã—Ö –≤ –æ—á–µ—Ä–µ–¥—å RabbitMQ|
|**rabbitmq_message_process_time_seconds**|Histogram|—Å–µ–∫—É–Ω–¥—ã|–í—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ–¥–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è –æ—Ç –ø–æ–ª—É—á–µ–Ω–∏—è –¥–æ –æ—Ç–ø—Ä–∞–≤–∫–∏ –æ—Ç–≤–µ—Ç–∞|
|**rabbitmq_connection_errors_total**|Counter|—à—Ç.|–ß–∏—Å–ª–æ –æ—à–∏–±–æ–∫ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ RabbitMQ|
|**rabbitmq_reconnects_total**|Counter|—à—Ç.|–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —É—Å–ø–µ—à–Ω—ã—Ö –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π –∫ RabbitMQ|

## –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

|–ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è|–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é|–û–ø–∏—Å–∞–Ω–∏–µ
|----------|----------|----------|
|**RABBITMQ_URI**|amqp://guest:guest@rabbitmq/|URL –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ RabbitMQ|
|**VECTORIZE_MODEL**|Tochka-AI/ruRoPEBert-e5-base-2k|–ú–æ–¥–µ–ª—å –¥–ª—è –≤–µ–∫—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏|
|**BATCH_SIZE**|32|–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–µ–∫—Å—Ç–æ–≤ –≤ –æ–¥–Ω–æ–º –±–∞—Ç—á–µ|
|**MAX_WAIT**|0.1|–í—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π —á–∞—Å—Ç–∏—á–Ω–æ–≥–æ –±–∞—Ç—á–∞ (–≤ —Å–µ–∫—É–Ω–¥–∞—Ö)
|**LOG_LEVEL**|INFO|–£—Ä–æ–≤–µ–Ω—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è (DEBUG, INFO, WARNING)|